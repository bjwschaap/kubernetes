#!/bin/sh
repo=gcr.io/google_containers
# When changing kubernetes_version remember to also update:
# - pkg/kubelet/Dockerfile
# - pkg/e2e-test/Dockerfile
kubernetes_version=v1.14.4
coredns_version=1.3.1
pause_version=3.1
etcd_version=3.3.10-1

common="
	kube-proxy:$kubernetes_version
	coredns:$coredns_version
	pause:$pause_version"

control="
	kube-apiserver:$kubernetes_version
	kube-controller-manager:$kubernetes_version
	kube-scheduler:$kubernetes_version
	etcd:$etcd_version"

oi() {
	local i="$1"
	digest=$(docker image inspect --format '{{index .RepoDigests 0}}' "$repo/$i")
	echo "$repo/${i}@${digest#*@}"
}

if [ $# -ne 1 ] ; then
    echo >&2 "Need exactly one of \`control-plane' or \`common'"
    exit 1
fi

case $1 in
    common)	    pkgs="$common";;
    control-plane)  pkgs="$control" ;;
esac

for i in $pkgs ; do
	docker image pull "$repo/$i" 1>&2
done

echo "# autogenerated by:"
echo "#    $0 $@"
for i in $pkgs ; do
    oi "$i"
done
